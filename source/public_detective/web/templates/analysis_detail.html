{% extends "base.html" %}
{% block title %}
  Detetive Público - Detalhes da Análise
{% endblock title %}
{% block content %}
  <div class="px-4 pb-12 mx-auto max-w-7xl sm:px-6 lg:px-8">
    <!-- Breadcrumb -->
    <nav class="mb-8">
      <a href="{{ url_for("analyses") }}"
         class="inline-flex gap-2 items-center py-1.5 px-3 -ml-3 rounded-lg transition-colors text-text-muted dark:hover:text-white dark:hover:bg-white/5 hover:text-text hover:bg-text-muted/5">
        <svg xmlns="http://www.w3.org/2000/svg"
             width="20"
             height="20"
             viewBox="0 0 24 24"
             fill="none"
             stroke="currentColor"
             stroke-width="2"
             stroke-linecap="round"
             stroke-linejoin="round">
          <path d="m15 18-6-6 6-6" />
        </svg>
        Voltar para Análises
      </a>
    </nav>
    <!-- Header Section -->
    <header class="mb-8">
      <div class="flex flex-col gap-6 justify-between items-start md:flex-row">
        <div class="space-y-2">
          <div class="flex gap-2 items-center mb-2 text-text-muted">
            <svg xmlns="http://www.w3.org/2000/svg"
                 width="18"
                 height="18"
                 viewBox="0 0 24 24"
                 fill="none"
                 stroke="currentColor"
                 stroke-width="2"
                 stroke-linecap="round"
                 stroke-linejoin="round">
              <rect x="4" y="2" width="16" height="20" rx="2" ry="2" />
              <path d="M9 22v-4h6v4" />
              <path d="M8 6h.01" />
              <path d="M16 6h.01" />
              <path d="M12 6h.01" />
              <path d="M12 10h.01" />
              <path d="M12 14h.01" />
              <path d="M16 10h.01" />
              <path d="M16 14h.01" />
              <path d="M8 10h.01" />
              <path d="M8 14h.01" />
            </svg>
            <span class="text-lg font-medium">{{ analysis.agency }}</span>
          </div>
          <div class="flex gap-3 items-center group">
            <h1 class="text-3xl font-bold tracking-tight md:text-4xl dark:text-white text-text font-heading">
              {{ analysis.control_number }}
            </h1>
            <button onclick="navigator.clipboard.writeText('{{ analysis.control_number }}'); const original = this.innerHTML; this.innerHTML = '
              <svg xmlns
                   '
                   http://www.w3.org/2000/svg
                   '
                   width
                   '
                   16
                   '
                   height
                   '
                   16
                   '
                   viewBox
                   '
                   0
                   0
                   24
                   24
                   '
                   fill
                   '
                   none
                   '
                   stroke
                   '
                   currentColor
                   '
                   stroke-width
                   '
                   2
                   '
                   stroke-linecap
                   '
                   round
                   '
                   stroke-linejoin
                   '
                   round
                   '>
                <polyline points=\'20 6 9 17 4 12\'/>
              </svg>
              '; setTimeout(() => this.innerHTML = original, 2000)" class="p-2 rounded-lg opacity-0 transition-all group-hover:opacity-100 focus:opacity-100 bg-text-muted/5 text-text-muted dark:hover:text-white dark:bg-white/5 dark:hover:bg-white/10 hover:text-text hover:bg-text-muted/10" title="Copiar Identificador">
              <svg xmlns="http://www.w3.org/2000/svg"
                   width="16"
                   height="16"
                   viewBox="0 0 24 24"
                   fill="none"
                   stroke="currentColor"
                   stroke-width="2"
                   stroke-linecap="round"
                   stroke-linejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
              </svg>
            </button>
          </div>
          <div class="flex flex-wrap gap-3 items-center pt-1">
            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-bold tracking-wide {% if analysis.score > 70 %}bg-red-100 text-red-800 border border-red-200 dark:bg-red-900/30 dark:text-red-400 dark:border-red-800/50 {% elif analysis.score > 40 %}bg-yellow-100 text-yellow-800 border border-yellow-200 dark:bg-yellow-900/30 dark:text-yellow-400 dark:border-yellow-800/50 {% else %}bg-green-100 text-green-800 border border-green-200 dark:bg-green-900/30 dark:text-green-400 dark:border-green-800/50{% endif %}">
              Risco: {{ analysis.score }}/100
            </span>
            <span class="inline-flex items-center py-1 px-3 text-sm font-medium rounded-full border bg-surface/50 text-text-muted border-text-muted/10 dark:bg-secondary/50 dark:text-slate-300 dark:border-white/10">
              {{ analysis.status }}
            </span>
          </div>
        </div>
        {% if analysis.official_link %}
          <a href="{{ analysis.official_link }}"
             target="_blank"
             class="hidden gap-2 items-center py-3 px-6 font-bold text-white rounded-xl shadow-lg transition-all md:inline-flex hover:-translate-y-0.5 bg-accent shadow-accent/20 hover:bg-accent/90 hover:shadow-accent/40">
            Ver no Portal Oficial
            <svg xmlns="http://www.w3.org/2000/svg"
                 width="16"
                 height="16"
                 viewBox="0 0 24 24"
                 fill="none"
                 stroke="currentColor"
                 stroke-width="2"
                 stroke-linecap="round"
                 stroke-linejoin="round">
              <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" />
              <polyline points="15 3 21 3 21 9" /><line x1="10" y1="14" x2="21" y2="3" />
            </svg>
          </a>
        {% endif %}
      </div>
    </header>
    <!-- Stats Bar -->
    <div class="grid grid-cols-1 gap-4 mb-8 md:grid-cols-3">
      <div class="p-4 rounded-xl border bg-surface/30 border-text-muted/5 backdrop-blur-sm dark:bg-secondary/30 dark:border-white/5">
        <span class="block mb-1 text-xs tracking-wider uppercase text-text-muted">Valor Estimado</span>
        <span class="text-xl font-bold dark:text-white text-text">{{ analysis.estimated_value }}</span>
      </div>
      <div class="p-4 rounded-xl border bg-surface/30 border-text-muted/5 backdrop-blur-sm dark:bg-secondary/30 dark:border-white/5">
        <span class="block mb-1 text-xs tracking-wider uppercase text-text-muted">Economia Potencial</span>
        {% if analysis.red_flags %}
          {% set total_savings = namespace(value=0) %}
          {% for flag in analysis.red_flags %}
            {% if flag.potential_savings %}
              {% set savings_float = flag.potential_savings.replace('R$ ', '').replace('.', '').replace(',', '.') | float %}
              {% set total_savings.value = total_savings.value + savings_float %}
            {% endif %}
          {% endfor %}
          <span class="text-xl font-bold text-green-600 dark:text-green-400">
            {% if total_savings.value > 0 %}
              R$ {{ "{:,.2f}".format(total_savings.value).replace(",", "X").replace(".", ",").replace("X", ".") }}
            {% else %}
              -
            {% endif %}
          </span>
        {% else %}
          <span class="text-xl font-bold text-text-muted">-</span>
        {% endif %}
      </div>
      <div class="p-4 rounded-xl border bg-surface/30 border-text-muted/5 backdrop-blur-sm dark:bg-secondary/30 dark:border-white/5">
        <span class="block mb-1 text-xs tracking-wider uppercase text-text-muted">Data de Publicação</span>
        <span class="text-xl font-bold dark:text-white text-text">{{ analysis.publication_date.strftime("%d/%m/%Y") if analysis.publication_date else 'N/A' }}</span>
      </div>
    </div>
    <div class="grid grid-cols-1 gap-8 lg:grid-cols-3">
      <!-- Main Content (Left Column) -->
      <div class="space-y-8 lg:col-span-2">
        <!-- Summaries -->
        <section class="p-6 space-y-6 rounded-xl border bg-surface/30 border-text-muted/5 backdrop-blur-sm dark:bg-secondary/30 dark:border-white/5">
          <div>
            <h2 class="flex gap-2 items-center mb-3 text-lg font-bold dark:text-white text-text font-heading">
              <svg xmlns="http://www.w3.org/2000/svg"
                   width="20"
                   height="20"
                   viewBox="0 0 24 24"
                   fill="none"
                   stroke="currentColor"
                   stroke-width="2"
                   stroke-linecap="round"
                   stroke-linejoin="round"
                   class="text-accent">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                <polyline points="14 2 14 8 20 8" /><line x1="16" y1="13" x2="8" y2="13" /><line x1="16" y1="17" x2="8" y2="17" /><polyline points="10 9 9 9 8 9" />
              </svg>
              Resumo da Licitação
            </h2>
            <p class="leading-relaxed text-text dark:text-slate-300">{{ analysis.summary }}</p>
          </div>
          {% if analysis.analysis_summary %}
            <div class="pt-6 border-t border-text-muted/5 dark:border-white/5">
              <h2 class="flex gap-2 items-center mb-3 text-lg font-bold dark:text-white text-text font-heading">
                <svg xmlns="http://www.w3.org/2000/svg"
                     width="20"
                     height="20"
                     viewBox="0 0 24 24"
                     fill="none"
                     stroke="currentColor"
                     stroke-width="2"
                     stroke-linecap="round"
                     stroke-linejoin="round"
                     class="text-accent">
                  <circle cx="12" cy="12" r="10" /><line x1="12" y1="16" x2="12" y2="12" /><line x1="12" y1="8" x2="12.01" y2="8" />
                </svg>
                Resumo da Análise
              </h2>
              <p class="leading-relaxed text-text dark:text-slate-300">{{ analysis.analysis_summary }}</p>
            </div>
          {% endif %}
        </section>
        <!-- Risk Rationale -->
        <section class="bg-surface/30 dark:bg-secondary/30 border rounded-xl p-6 backdrop-blur-sm {% if analysis.score > 70 %}border-red-200 bg-red-50 dark:border-red-500/30 dark:bg-red-500/5 {% elif analysis.score > 40 %}border-yellow-200 bg-yellow-50 dark:border-yellow-500/30 dark:bg-yellow-500/5 {% else %}border-green-200 bg-green-50 dark:border-green-500/30 dark:bg-green-500/5{% endif %}">
          <h2 class="flex gap-2 items-center mb-3 text-lg font-bold dark:text-white text-text font-heading">
            <svg xmlns="http://www.w3.org/2000/svg"
                 width="20"
                 height="20"
                 viewBox="0 0 24 24"
                 fill="none"
                 stroke="currentColor"
                 stroke-width="2"
                 stroke-linecap="round"
                 stroke-linejoin="round"
                 class=" {% if analysis.score > 70 %}text-red-600 dark:text-red-400 {% elif analysis.score > 40 %}text-yellow-600 dark:text-yellow-400 {% else %}text-green-600 dark:text-green-400{% endif %}">
              <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" />
              <polyline points="14 2 14 8 20 8" /><line x1="12" y1="18" x2="12" y2="12" /><line x1="9" y1="15" x2="15" y2="15" />
            </svg>
            Racional do Risco
          </h2>
          <p class="leading-relaxed text-text dark:text-slate-300">{{ analysis.rationale }}</p>
        </section>
        <!-- Red Flags -->
        <section>
          <h2 class="flex gap-2 items-center mb-4 text-lg font-bold dark:text-white text-text font-heading">
            <svg xmlns="http://www.w3.org/2000/svg"
                 width="20"
                 height="20"
                 viewBox="0 0 24 24"
                 fill="none"
                 stroke="currentColor"
                 stroke-width="2"
                 stroke-linecap="round"
                 stroke-linejoin="round"
                 class="text-red-400">
              <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z" />
              <line x1="4" y1="22" x2="4" y2="15" />
            </svg>
            Pontos de Atenção
            <span class="py-1 px-2 ml-2 text-xs text-white rounded-full bg-text-muted/10 dark:bg-white/10">{{ analysis.red_flags|length }}</span>
          </h2>
          <div class="grid grid-cols-1 gap-4">
            {% for flag in analysis.red_flags %}
              <div class="flex flex-col p-6 h-full rounded-xl border transition-colors bg-surface/30 border-text-muted/5 backdrop-blur-sm dark:bg-secondary/30 dark:border-white/5 dark:hover:border-white/10 hover:border-text-muted/10">
                <div class="flex justify-between items-start mb-4">
                  <span class="py-1 px-2 text-xs font-bold tracking-wider uppercase rounded border text-accent bg-accent/10 border-accent/20">
                    {{ flag.category }}
                  </span>
                  <span class="text-xs font-bold uppercase tracking-wider {% if flag.severity == 'GRAVE' %}text-red-600 dark:text-red-400 {% elif flag.severity == 'MODERADA' %}text-yellow-600 dark:text-yellow-400 {% else %}text-green-600 dark:text-green-400{% endif %}">
                    {{ flag.severity }}
                  </span>
                </div>
                <p class="mb-4 text-sm font-medium dark:text-white text-text">{{ flag.description }}</p>
                <div class="p-3 mb-4 rounded-lg border-l-2 bg-black/5 border-accent dark:bg-black/30">
                  <p class="text-xs italic text-text-muted dark:text-slate-400">"{{ flag.evidence_quote }}"</p>
                </div>
                <p class="flex-grow mb-4 text-xs leading-relaxed text-text dark:text-slate-300">{{ flag.auditor_reasoning }}</p>
                {% if flag.potential_savings %}
                  <div class="flex gap-2 items-center pt-4 mt-auto text-xs font-medium text-green-600 border-t dark:text-green-400 border-text-muted/5 dark:border-white/5">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         width="14"
                         height="14"
                         viewBox="0 0 24 24"
                         fill="none"
                         stroke="currentColor"
                         stroke-width="2"
                         stroke-linecap="round"
                         stroke-linejoin="round">
                      <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />
                    </svg>
                    Economia Potencial: {{ flag.potential_savings }}
                  </div>
                {% endif %}
                {% if flag.sources %}
                  <div class="pt-4 mt-4 border-t border-text-muted/5 dark:border-white/5">
                    <h4 class="mb-3 text-xs font-bold tracking-wider uppercase text-text-muted">
                      Fontes de Referência ({{ flag.sources|length }})
                    </h4>
                    <div class="space-y-3">
                      {% for source in flag.sources %}
                        <div class="flex flex-col p-3 h-full text-xs rounded-lg border bg-text-muted/5 border-text-muted/5 dark:bg-white/5 dark:border-white/5">
                          <div class="flex gap-2 items-center mb-2">
                            {% if source.type == 'Varejo' %}
                              <svg xmlns="http://www.w3.org/2000/svg"
                                   width="14"
                                   height="14"
                                   viewBox="0 0 24 24"
                                   fill="none"
                                   stroke="currentColor"
                                   stroke-width="2"
                                   stroke-linecap="round"
                                   stroke-linejoin="round"
                                   class="text-accent shrink-0"
                                   title="Varejo">
                                <path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z" />
                                <path d="M3 6h18" />
                                <path d="M16 10a4 4 0 0 1-8 0" />
                              </svg>
                            {% elif source.type == 'Atacado' %}
                              <svg xmlns="http://www.w3.org/2000/svg"
                                   width="14"
                                   height="14"
                                   viewBox="0 0 24 24"
                                   fill="none"
                                   stroke="currentColor"
                                   stroke-width="2"
                                   stroke-linecap="round"
                                   stroke-linejoin="round"
                                   class="text-accent shrink-0"
                                   title="Atacado">
                                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" />
                                <polyline points="3.27 6.96 12 12.01 20.73 6.96" /><line x1="12" y1="22.08" x2="12" y2="12" /><line x1="3.27" y1="16.96" x2="12" y2="12.01" /><line x1="20.73" y1="16.96" x2="12" y2="12.01" />
                              </svg>
                            {% elif source.type == 'Site Oficial' %}
                              <svg xmlns="http://www.w3.org/2000/svg"
                                   width="14"
                                   height="14"
                                   viewBox="0 0 24 24"
                                   fill="none"
                                   stroke="currentColor"
                                   stroke-width="2"
                                   stroke-linecap="round"
                                   stroke-linejoin="round"
                                   class="text-accent shrink-0"
                                   title="Site Oficial">
                                <circle cx="12" cy="12" r="10" /><line x1="2" y1="12" x2="22" y2="12" />
                                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" />
                              </svg>
                            {% elif source.type == 'Painel de Preços' %}
                              <svg xmlns="http://www.w3.org/2000/svg"
                                   width="14"
                                   height="14"
                                   viewBox="0 0 24 24"
                                   fill="none"
                                   stroke="currentColor"
                                   stroke-width="2"
                                   stroke-linecap="round"
                                   stroke-linejoin="round"
                                   class="text-accent shrink-0"
                                   title="Painel de Preços">
                                <line x1="18" y1="20" x2="18" y2="10" /><line x1="12" y1="20" x2="12" y2="4" /><line x1="6" y1="20" x2="6" y2="14" />
                              </svg>
                            {% elif source.type == 'Banco de Preços' %}
                              <svg xmlns="http://www.w3.org/2000/svg"
                                   width="14"
                                   height="14"
                                   viewBox="0 0 24 24"
                                   fill="none"
                                   stroke="currentColor"
                                   stroke-width="2"
                                   stroke-linecap="round"
                                   stroke-linejoin="round"
                                   class="text-accent shrink-0"
                                   title="Banco de Preços">
                                <ellipse cx="12" cy="5" rx="9" ry="3" />
                                <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3" />
                                <path d="M3 5v14c0 1.66 4 3 9 3s 9-1.34 9-3V5" />
                              </svg>
                            {% else %}
                              <svg xmlns="http://www.w3.org/2000/svg"
                                   width="14"
                                   height="14"
                                   viewBox="0 0 24 24"
                                   fill="none"
                                   stroke="currentColor"
                                   stroke-width="2"
                                   stroke-linecap="round"
                                   stroke-linejoin="round"
                                   class="text-accent shrink-0"
                                   title="Outro">
                                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
                                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
                              </svg>
                            {% endif %}
                            <span class="font-bold tracking-wider uppercase text-[10px] text-text-muted">{{ source.type }}</span>
                            <span class="text-xs text-text-muted dark:text-slate-600">•</span>
                            <span class="font-medium leading-snug text-text dark:text-slate-200">{{ source.name }}</span>
                          </div>
                          {% if source.rationale %}
                            <p class="flex-grow leading-relaxed text-text-muted dark:text-slate-400">{{ source.rationale }}</p>
                          {% endif %}
                          {% if source.reference_price %}
                            <div class="flex justify-between items-center pt-3 mt-3 border-t border-text-muted/5 dark:border-white/5">
                              <span class="font-medium text-text-muted">Preço de Referência</span>
                              <div class="text-right">
                                <span class="font-bold text-green-600 dark:text-green-400">{{ source.reference_price }}</span>
                                <span class="ml-1 text-[10px] text-text-muted">{{ source.price_unit }}</span>
                              </div>
                            </div>
                          {% endif %}
                        </div>
                      {% endfor %}
                    </div>
                  </div>
                {% endif %}
              </div>
            {% else %}
              <div class="col-span-full py-10 text-center rounded-xl border border-dashed text-text-muted bg-surface/10 border-text-muted/5 dark:bg-secondary/10 dark:border-white/5">
                Nenhum ponto de atenção crítico identificado.
              </div>
            {% endfor %}
          </div>
        </section>
      </div>
      <!-- Sidebar (Right Column) -->
      <div class="space-y-6">
        <!-- Details Card -->
        <div class="p-6 rounded-xl border bg-surface/30 border-text-muted/5 backdrop-blur-sm dark:bg-secondary/30 dark:border-white/5">
          <h3 class="flex gap-2 items-center mb-4 text-sm font-bold tracking-wider uppercase dark:text-white text-text">
            <svg xmlns="http://www.w3.org/2000/svg"
                 width="16"
                 height="16"
                 viewBox="0 0 24 24"
                 fill="none"
                 stroke="currentColor"
                 stroke-width="2"
                 stroke-linecap="round"
                 stroke-linejoin="round"
                 class="text-text-muted">
              <circle cx="12" cy="12" r="10" /><line x1="12" y1="16" x2="12" y2="12" /><line x1="12" y1="8" x2="12.01" y2="8" />
            </svg>
            Detalhes da Compra
          </h3>
          <div class="space-y-4">
            <div>
              <label class="block mb-1 tracking-wider uppercase text-[10px] text-text-muted">Localização</label>
              <div class="flex gap-2 items-center text-sm text-text dark:text-slate-200">
                <svg xmlns="http://www.w3.org/2000/svg"
                     width="14"
                     height="14"
                     viewBox="0 0 24 24"
                     fill="none"
                     stroke="currentColor"
                     stroke-width="2"
                     stroke-linecap="round"
                     stroke-linejoin="round"
                     class="text-text-muted">
                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
                  <circle cx="12" cy="10" r="3" />
                </svg>
                {{ analysis.location }}
              </div>
            </div>
            <div class="h-px bg-text-muted/5 dark:bg-white/5"></div>
            <div>
              <label class="block mb-1 tracking-wider uppercase text-[10px] text-text-muted">Modalidade</label>
              <div class="flex gap-2 items-center text-sm text-text dark:text-slate-200">
                <svg xmlns="http://www.w3.org/2000/svg"
                     width="14"
                     height="14"
                     viewBox="0 0 24 24"
                     fill="none"
                     stroke="currentColor"
                     stroke-width="2"
                     stroke-linecap="round"
                     stroke-linejoin="round"
                     class="text-text-muted">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                  <polyline points="14 2 14 8 20 8" /><line x1="16" y1="13" x2="8" y2="13" /><line x1="16" y1="17" x2="8" y2="17" /><polyline points="10 9 9 9 8 9" />
                </svg>
                {{ analysis.modality }}
              </div>
            </div>
            <div class="h-px bg-text-muted/5 dark:bg-white/5"></div>
            <div>
              <label class="block mb-1 tracking-wider uppercase text-[10px] text-text-muted">Status</label>
              <div class="flex gap-2 items-center text-sm text-text dark:text-slate-200">
                <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                {{ analysis.status }}
              </div>
            </div>
          </div>
          {% if analysis.official_link %}
            <div class="pt-6 mt-6 border-t md:hidden border-text-muted/5 dark:border-white/5">
              <a href="{{ analysis.official_link }}"
                 target="_blank"
                 class="flex gap-2 justify-center items-center py-3 px-4 w-full text-sm font-bold text-white rounded-xl shadow-lg transition-all bg-accent shadow-accent/20 hover:bg-accent/90">
                Ver no Portal Oficial
                <svg xmlns="http://www.w3.org/2000/svg"
                     width="14"
                     height="14"
                     viewBox="0 0 24 24"
                     fill="none"
                     stroke="currentColor"
                     stroke-width="2"
                     stroke-linecap="round"
                     stroke-linejoin="round">
                  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" />
                  <polyline points="15 3 21 3 21 9" /><line x1="10" y1="14" x2="21" y2="3" />
                </svg>
              </a>
            </div>
          {% endif %}
        </div>
        <!-- Sources Card -->
        {% if analysis.grounding_metadata and analysis.grounding_metadata.sources %}
          <div class="p-6 rounded-xl border bg-surface/30 border-text-muted/5 backdrop-blur-sm dark:bg-secondary/30 dark:border-white/5">
            <h3 class="flex gap-2 items-center mb-4 text-sm font-bold tracking-wider uppercase dark:text-white text-text">
              <svg xmlns="http://www.w3.org/2000/svg"
                   width="16"
                   height="16"
                   viewBox="0 0 24 24"
                   fill="none"
                   stroke="currentColor"
                   stroke-width="2"
                   stroke-linecap="round"
                   stroke-linejoin="round"
                   class="text-text-muted">
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
              </svg>
              Fontes Consultadas
            </h3>
            <div class="space-y-3">
              {% for source in analysis.grounding_metadata.sources %}
                <a href="{{ source.resolved_url or source.original_url }}"
                   target="_blank"
                   class="block p-3 rounded-lg border transition-all bg-text-muted/5 border-text-muted/5 group dark:bg-white/5 dark:border-white/5 dark:hover:bg-white/10 dark:hover:border-white/10 hover:bg-text-muted/10 hover:border-text-muted/10">
                  <div class="flex gap-2 items-start">
                    <div class="mt-0.5 transition-colors text-text-muted group-hover:text-accent">
                      <svg xmlns="http://www.w3.org/2000/svg"
                           width="12"
                           height="12"
                           viewBox="0 0 24 24"
                           fill="none"
                           stroke="currentColor"
                           stroke-width="2"
                           stroke-linecap="round"
                           stroke-linejoin="round">
                        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" />
                        <polyline points="15 3 21 3 21 9" /><line x1="10" y1="14" x2="21" y2="3" />
                      </svg>
                    </div>
                    <span class="text-xs text-text line-clamp-2 dark:group-hover:text-white dark:text-slate-300 group-hover:text-text">
                      {{ source.title or (source.resolved_url or source.original_url)|truncate(50) }}
                    </span>
                  </div>
                </a>
              {% endfor %}
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
{% endblock content %}
